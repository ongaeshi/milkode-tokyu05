! TokyuRuby会議05 LT 原稿

!! 準備
○ブラウザ 4 エディタ 3
○$ cd milkode_tokyu05 && milk web
○$ milk setdb milkode_tokyu05
○~/tmp/memo.txt を開いておく
○スライド開く、フルスクリーンモード

!! ページ1: Rubyで作ったソースコード検索エンジンMilkode
●スライドをフルスクリーン、文字サイズを調整する

こんにちはongaeshiと申します。普段は仕事としてコンシューマゲームのプログラマをしており、趣味でもソフトウェアを作って公開しています。今日は私が開発しているソースコード検索エンジンのMilkodeをご紹介させて頂きたいと思います。

!! ページ2: 作った動機
● [ENTER] コードを読むことの重要性は年々向上・・

コードリーディングの重要性が叫ばれるようになり久しいですが、そのためのツールは昔から余り変わっていません。エディタ、grep、タグファイル等です。

検索ツールにフォーカスを当てますと、
grep等のコマンドラインツールは一つ一つファイルを調べるため時間がかかりますし、
Web上にあるソースコード検索エンジンは、grepのようなAND検索が出来なかったり、非公開のソースコードを検索することが出来ません。

● [ENTER] もっとコードリーディングを簡単にしたい

これらの不満点を解消し、もっとコードリーディングを簡単に行えるようにするためにMilkodeの開発を始めました。

!! ページ3: Milkodeの特徴
続きましてMilkodeの特徴です。

● [ENTER] テキスト形式なら何でも
まず、テキスト形式であれば文字コード問わずどんなものでも検索対象に含めることが可能です。ローカルマシン内にデータベースを作成することも出来るため非公開のソースコードでも大丈夫です。

● [ENTER] 高速
次に高速性です。 20000ファイル位であれば1秒以内に検索することが出来ます。

● [ENTER] 行指向
既存のソースコード検索エンジンはキーワードにマッチする"ページ"を見つけるタイプのものが大半でした。Milkodeでは使い慣れたgrepと同じように特定のキーワードにマッチする"行"を見つけることが出来ます。

● [ENTER] エディタでもブラウザでも
ブラウザで検索可能な"milk web"、高速なgrepとして動作する"gmilk" など、状況に応じて最適なアプリを使い分けることが出来ます。ブラウザで検索したファイルをエディタで開くといった連携機能も用意されています。

● [ENTER] RubyGemsのおかげ
最後にMilkodeは様々なRubyGemsを利用して作られています。代表的なものとしては ストレージ＆検索エンジンのrroonga, Web
フレームワークのsinatra, ソースコードを色付けする coderay 等です。オープンソースなので各gemの使い方やカスタマイズの方法の参考になるかもしれません。

!! ページ4: デモ
それでは実際に動いている所をご紹介したいと思います。

● milk web画面を開く
milk web コマンドでアプリを起動するとこのような画面が表示されます。

現在はruby, mruby, node.js, rails 等のソースコードがgithubから登録されており、全部で13207ファイルあります。さっそく検索してみましょう。ruby, mruby, activerecord .. これ位のスピード感で検索することが出来ます。

それではデモとしてmrubyの String#split の実装を読んでみます。

まずはAND検索を使ってエントリポイントを探します、 rb_deine_method split .. はい出て来ました。

試しにrubyで同じキーワードで検索すると..、String以外にPathnameやBigdecimalにもsplitメソッドがあることが分かります。

mruby に戻りましょう。mrb_str_split_m 関数を探します。見つかりました、それではこの関数をエディタで開いてみます。

行番号をクリックするとその場所を示すパスが表示されるのでコピーしておきます。
●行番号をクリック、テキストファイルに貼付け

gmilkというコマンドツールはgrepと同じ出力形式のためEmacsのgrepモードを使うと簡単にファイルの実体にジャンプすることが出来ます。先ほどメモしておいたパスを使って検索します..
●gmilk eeeee、エディタでファイルにジャンプ

●エディタとブラウザを左右に並べて開く
同じ箇所をブラウザとエディタの両方で開くことが出来ました。こんな感じで快適にコードリーディングを進めることが出来ます。

今日ご紹介したデモ環境は私のノートパソコン上で動かしています。TokyuRuby会議中は触れるようにしておきますので、良かったら触り心地を確かめに遊びに来て下さい。

!! ページ4: インストール
インストールは gem install milkode で簡単に出来ます。

!! ページ5: ありがとうございました
Milkodeはまだまだ発展途中のソフトウェアのため、皆さんに使って頂きフィードバックがもらえればと思っています。
何かありましたらTwitterやメール等で教えて頂ければ幸いです。

どうもありがとうございました。
