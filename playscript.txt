! TokyuRuby会議05 LT 原稿
!! ページ1: Rubyで作ったソースコード検索エンジンMilkode
●スライドをフルスクリーン、文字サイズを調整する

こんにちはongaeshiと申します。普段は職業プログラマとしてコンシューマゲームのプログラマをしていますが、趣味でもソフトウェアを作って公開しています。本当は一般受けしたいものを作りたいと常々思っているのですが、なぜか作っていくとプログラマにしかその価値が分かりにくいものになってしまうのが最近の悩みです。

今日は私がRubyで開発している、ソースコード検索エンジンのMilkodeをご紹介させて頂きたいと思います。

!! ページ2: 動機
● [ENTER] コードを読むことの重要性は年々向上
● [ENTER] それを支援するためのツールは余り変わっていない・・
● [ENTER] "grep" + "Webのソースコード検索" = ??
● [ENTER] もっとコードリーディングを簡単にしたい

<<<
コードを読む技術が大切と叫ばれるようになって久しいですがコードリーディングのためのツールは昔から余り変わっていません。エディタ、grep、タグファイル等です。
今の技術を使えばもっとコードリーディングを簡単に出来るのではないかと考えました。

今回は特定のコードを検索する、ということにフォーカス
grepは検索の度に一つ一つファイルを開いていくために時間がかかります。
goolgeソースコード検索やkodersといったソースコード検索エンジンは、grepのようにAND検索が出来ないですし、ローカルにある非公開のソースコードを検索対象に加えることが出来ません。

これらの不満点を解消し、もっとコードリーディングを簡単に行えるようにするためにMilkodeの開発を始めました。
<<<

!! ページ3: Milkodeの特徴
続きましてMilkodeの特徴です。

● [ENTER] テキストファイルなら何でも
● [ENTER] 高速
● [ENTER] 行指向
● [ENTER] エディタでもブラウザでも
● [ENTER] RubyGemsのおかげ

<<<
* 大量のファイルから素早く検索出来る (20000ファイル位であれば1秒以内)
* ページではなく行を見つけることが出来る (grepと同じ使用感)
* エディタ、ブラウザ、どちらからも検索することが出来る
* たくさんのRubyGemsのおかげで成り立っている (rroonga, sinatra, code-ray ..)
<<<

!! ページ4: デモ
それでは実際に動いている所をご紹介したいと思います。

●milk web画面を開く
milk web コマンドでブラウザを起動するとこのような画面が表示されます。現在はruby, mruby, node.js, rails 等のソースコードがgithubから直接登録されており、全体でxxxxファイル登録されています。例えばxxxxで検索してみます...、これ位のスピード感で検索することが出来ます(もう何個かキーワード入力)。

ではデモとして試しにmrubyのソースコードを読んでみます。今回はガベージコレクションのコールグラフを追ってみることにします。

コードを読むときは何時でもメモできるように空のテキストファイルを開いておくと便利です。 
●エディタ開く、空のテキストファイルを開く

まずはエントリポイントを探すためにGC.StartのC言語上での実体を見つけましょう。rb_define_method(スペース)gc(スペース)start で検索してみます。
●rb_define_method gc start

見つかりました、行番号をクリックするとその場所を示すテキストが表示されるのでメモしておきます。
●行番号をクリック、テキストファイルに貼付け

関数の中身を見ながら深く潜っていきます
●xxxxxを検索、テキスト
●xxxxxを検索、テキスト
●xxxxxを検索、テキスト
●xxxxxを検索、テキスト
●eeeeeを検索、テキスト

eeeeeまで来ました。さて、ここらで使い慣れたエディタで開いてみましょう。gmilkというツールはgrepと同じ出力形式なのでEmacsのgrepモードを使うと簡単にファイルの実体にジャンプすることが出来ます。先ほどメモしておいたパスを使って検索してみましょう。
●gmilk eeeee、エディタでファイルにジャンプ

●エディタとブラウザを左右に並べて開く
同じ箇所をブラウザとエディタの両方で開くことが出来ました。

さらに複数個のパスを空白で
<<<
 /mruby/src/gc.c:945
 /mruby/src/gc.c:867
 /mruby/src/gc.c:779
 /mruby/src/gc.c:717
<<<
<<<

!! ページ4: インストール
インストールは gem install milkode で簡単に出来ます。

!! ページ5: ありがとうございました
今日ご紹介したデモ環境は私のノートパソコン上で実際に触ることが出来ます。
実際の検索にかかるスピードやアプリの操作感を良かったら一度お試しください。

どうもありがとうございました。
